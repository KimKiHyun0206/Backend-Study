# Persistence Context
> ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½

* ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì—ì„œ ê°ì²´ë¥¼ ë³´ê´€í•˜ëŠ” ê°€ìƒì˜ ë°ì´í„°ë² ì´ìŠ¤ ì—­í• 
* EntityManager ë¥¼ í†µí•´ ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì¡°íšŒí•˜ë©´ EntityManager ëŠ” Persistence Context ì— Entity ë¥¼ ë³´ê´€í•˜ê³  ê´€ë¦¬í•œë‹¤

```java
public class Sample{
    public static void main(String[] args) {
        EntityManager entityManager = new EntityManager();
        
        entityManager.persist(new Member("kim",22));
    }
}
```

* EntityManager ëŠ” í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì§„ë‹¤
* EntityManager ë¥¼ í†µí•´ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

<br>

# Persistent Context : Entity`s LifeCycle
* **ë¹„ì˜ì†, new/transient** : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì „í˜€ ê´€ê³„ ì—†ëŠ” ìƒíƒœ
* **ì˜ì†, managed** : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ìƒíƒœ
* **ì¤€ì˜ì†, detached** : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì—ˆë‹¤ê°€ ë¶„ë¦¬ëœ ìƒíƒœ
  * 1ì°¨ ìºì‹œ, ì“°ê¸° ì§€ì—°, ë³€ê²½ ê°ì§€, ì§€ì—° ë¡œë”©ì„ í¬í•¨í•œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì œê³µí•˜ëŠ” ì–´ë– í•œ ê¸°ëŠ¥ë„ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤
  * í•˜ì§€ë§Œ ì‹ë³„ì ê°’ì„ ê°€ì§€ê³  ìˆë‹¤
* **ì‚­ì œ, removed** : ì‚­ì œëœ ìƒíƒœ

<center>

![img.png](../ğŸ”²%20Image%20ğŸ”²/Spring/Persistent%20Context-LifeCycle.png)

</center>

```java
public class Sample{
    public static void main(String[] args) {
        Member member = new Member();   //ë¹„ì˜ì† ìƒíƒœ
        EntityManager entityManager;
        
        entityManager.persist(member);  //ì˜ì† ìƒíƒœ


        //ì¤€ì˜ì† ìƒíƒœ ì˜ˆì‹œ 3ê°€ì§€
        entityManager.detach(member);   //ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬í•œë‹¤
        entityManager.clear();          //ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš´ë‹¤
        entityManager.close();          //ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œí•œë‹¤
        
        
        entityManager.remove(member);   //ì‚­ì œ
    }
}
```

<br>

# Persistence Context : íŠ¹ì§•

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì‹ë³„ì ê°’
* ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì—”í‹°í‹°ë¥¼ ì‹ë³„ì ê°’ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤
* ë”°ë¼ì„œ ì˜ì† ìƒíƒœëŠ” ì‹ë³„ì ê°’ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•œë‹¤

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
* JPA ëŠ” ë³´í†µ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ìˆœê°„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìƒˆë¡œ ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•œë‹¤
* ì´ë¥¼ flush ë¼ê³  í•œë‹¤

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆë‹¤
1. 1ì°¨ ìºì‹œ
2. ë™ì¼ì„± ë³´ì¥
3. íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°
4. ë³€ê²½ ê°ì§€
5. ì§€ì—° ë¡œë”©

- - -
* [ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸](https://velog.io/@neptunes032/JPA-%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EB%9E%80)