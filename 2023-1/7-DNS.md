# DNS

- - -

## DNS?

* 웹 사이트에 접속할 때 우리는 외우기 어려운 IP 주소 대신 도메인 이름을 사용한다
* 도메인 이름을 사용했을 때 입력한 도메인을 실제 네트워크 상에서 사용하는 IP 주소로 바꾸고 해당 IP 주소로 접속하는 과정이 필요하다
* 이러한 과정, 전체 시스템을 DNS라고 한다
* 이러한 시스템은 전세계적으로 약속된 규칙을 공유한다
* 상위 기관에서 인증된 기관에게 도메인을 생성하거나 IP 주소로 변경할 수 있는  '권한'을 부여한다
* DNS는 이처럼 상위 기관과 하위 기관과 같은 **계층 구조**를 가지는 **분산 데이터베이스 구조**를 가진다

## DNS 구성 요소

- - - 

1. 도메인 네임 스페이스, Domain Name Space
2. 네임 서버, Name Server = 권한 있는 DNS
3. 리졸버, Resolver = 권한 없는 DNS 서버

* 우선 "이 도메인 이름은 이 IP 주소이다"라는 텍스트를 저장하는 데이터베이스가 필요하다
* 그리고 분산된 데이터가 어디 저장되어 있는지 찾을 프로그램들이 필요하고 찾았으면 해당 IP 주소로 이동할 프로그램이 필요하다
    * 프로그램은 보통 브라우저를 사용한다
* 도메인 네임 스페이스라는 규칙으로 도메인 이름 저장을 분산한다
* 네임 서버가 해당 도메인 이름의 IP 주소를 찾는다
* 리졸버가 DNS 클라이언트 요청을 네임 서버로 전달하고 찾은 정보를 클라이언트에게 제공하는 기능을 수행한다
* 어떤 네임 서버에서 찾아야하는지, 이미 캐시 되어있는지 등 어떻게든 찾아서 클라이언트에게 찾았으면 찾은 것을 못 찾았다고 전달하는 역할을 한다
* 리졸버는 단말에 구현하는 것은 무리수라 보통은 리졸버가 구현된 네임 서버의 IP 주소만을 파악한다
* 대표적인 것이 KT/LG/SK 같은 통신사 DNS이고, 브라우저 우회 용도로 많이 쓰는 구글 DNS, 클라우드플레이아와 같은 public NDS 서버가 있다
* 그래서 거의 Resolver = Recursive DNS Server = Local Server = Recursor
* 어떤 자료에서는 리졸버라는 요소를 생략하기도 한다.

> #### 왜 이렇게 할까
> * 네임 서버가 한 대만 있지 않기 때문이다
> * 여러 개의 네임 서버가 있을 경우 어떤 네임 서버는 어떤 도메인의 IP 주소를 모를 수도 있다
> * 도메인을 계층적으로 구분하는, 정보를 분산하는 구조를 선택하게 되었다
> * 그래서 도메인에 [ . ] ㅇ 있는 것이다. 점은 계층을 나타낸다

## DNS 동작 방식 설명

- - -
> 웹 부라우저는 해결사 서버에게 요청한다 - www.hanshin.kr 주소를 알려주세요

> 해결사 서버는 최상위 기관에서 관리하는 네임 서버에게 요청한다 -> .kr이라는 도메인 있어?

> 최상위 기관에서 관리하는 네임 서버는 응답한다 - 그거 한국 거야 .kr 네임 서버로 가봐요

> 해결사 서버는 이제 .kr 네임 서버에게 요청한다 - 주소 있나요?

> .kr 네임 서버는 응답한다 - 네 `네임서버A`(hanshin의 도메인을 관리하는 네임서버)로 가세요

> 해결사 서버는 `네임서버A`에게 요청한다 - 주소 있나요?

> `네임서버A`는 응답한다 - 네 [ IP 주소 ]로 가세요

> 해결사 서버는 웹 브라우저에게 알려준다 - IP 주소로 가세요

## DNS 구성 요소 : 도메인 네임 스페이스

- - -

![img.png](img/DNS%20계층구조.png)

* DNS는 전세계적인 거대한 분산 시스템이다
* 도메인 네임 스페이스는 이러한 DNS가 저장 관리하는 계층적 구조를 의미한다
* 도메인 네임 스페이스는 최상위 루트 DNS 서버가 존재하고 그 하위로 연결된 모든 노드가 연속해서 이어진 계층 구조로 되어있다
    * 폴더 구조와 비슷하다

### 계층적 도메인 레벨, Hierarchical Domain Level

* 도메인 네임 스페이스의 트리 구조는 최상위 레벨부터 순차적으로 계층적 소속 관계를 나타낸다
* 하위 조직의 네임 스페이스를 할당하고 관리하는 방식은 각 하위 기관의 관리 책임자에게 위임된다
* 예를 들어 hanshin.kr 도메인은 kr 도메인을 관리하는 네임 서버에 등록되어 있었고 www.hanshin.kr은 hanshin.ac.kr 도메인을 관리하는 네임 서버에 등록되어 있다
* 이러한 위임 구조는 호스트의 증가에 대한 관리가 효율적으로 이루어지는 것을 가능하게 한다
* hanshin.kr은 kr 도메인을 관리하는 네임 서버에 등록되어 있는데 해당 하위 기관은 `네임서버 A`로 되어있다.
* 한신은 www.hanshin.ac.kr을 만들기 위해서 `네임서버 A`에 가서 도메인 레코드에 하위 도메인을 추가하면 된다

### Fully Qualified Domain Name, FQDN 전체 도메인 이름

> 도메인의 전체 이름을 표기하는 방식을 말한다.
> 일반적으로 도메인 이름은 www.hanshin.kr을 의미하기 때문에 이러한 용어가 나왔다

* `도메인 이름` : hanshin.kr
* `호스트 이름` : www
* `FQDN` : www.hanshin.kr

## DNS 구성 요소 : 네임 서버

- - -

* 문자열로 표현된 도메인 이름을 실제 컴퓨터가 통신할 때 사용하는 IP 주소로 변환시키기 위해 도메인 네임 스페이스의 트리 구조에 대한 정보가 필요한데 이러한 정보를 가지고 있는 서버를 네임 서버라고 한다
* 데이터베이스 역할, 찾아주는 역할, 요청 처리 응답 구현
* 전 세계에 13 개의 Root DNS 서버가 구축되어 있다
* 그리고 DNS 서버를 복사하여 같은 기능을 담당하는 미러 서버가 있다고 한다

#### Root DNS 서버

* ICANN이 직접 관리하는 절대 존엄 서버이다
* TLD DNS 서버 IP 주소를 저장하고 안내하는 역할을 한다

#### Top-Level Domain, TLD DNS 서버

* 도메인 등록 기관리 관리하는 서버이다
* Authoritative DNS 서버의 주소를 저장하고 안내하는 역할을 한다
* 도메인 판매 업체의 DNS 설정이 변경되면 도메인 등록 기관으로 전달되기 때문에 어떤 도메인이 어떤 판매업체에서 구매했는지 알 수 있다

#### Second-Level Domain, SLD DNS 서버

* 실제 개인 도메인과 IP 주소의 관계가 기록되는 서버이다
* 그래서 권한의 이미인 Authoritative가 붙었다. 일반적으로 도메인/호스팅 업체의 네임 서버를 말한다
* 개인 DNS 구축해도 이 경우에 해당한다

#### 권한 없는 DNS 서버 - 리졸버 서버, 리컬시브 서버, 리커서

* DNS 서버는 도메인 네임 스페이스를 위한 권한 있는 DNS 서버와 권한이 없는 DNS 서버로 구분된다
* 위 1, 2, 3은 권한 있는 DNS 서버이다
* 네임 스페이스를 위한 권한 있는 DNS 서버는 IP 주소와 도메인 이름을 매핑한다
* 네임 스페이스를 위한 권한 없는 DNs 서버는 질의를 통해 IP 주소를 알아내거나 캐시한다

## DNS 구성 요소 : 리졸버

- - -

* 리졸버는 웹 브라우저와 같은 DNS 클라이언트의 요청을 네임 서버로 전달하고 네임 서버로부터 정보를 받아 클라이언트에게 제공하는 기능을 수행한다
* 이 과정에서 리볼버는 하나의 네임 서버에게 DNS 요청을 전달하고 해당 서버에 정보가 없으면 다른 네임 서버에게 요청을 보내 정보를 받아 온다
* 이렇게 리졸버는 수많은 네임서버에 접근하여 사용자로부터 요청 받은 도메인의 IP 정보를 조회하는 기능을 수행한다

## DNS 동작 과정

- - -
![img_1.png](img/DNS%20동작%20과정.png)
> #### DNS 쿼리란?
> * DNS 클라이언트와 DNS 서버는 DNS 쿼리를 교환한다
> * DNS 쿼리는 Recursive 또는 Iterative으로 구분된다


> #### Recursive Query - 재귀적 질의
> * 결과물을 돌려주는 작업이다.
> * 결과적으로 Recursive 서버가 Recursive 쿼리를 웹 브라우저 등에게 돌려주는 역할을 한다
> * Recursive 쿼리를 받은 Recursive 서버는 Iterative하게 권한 있는 네임 서버로 Iterative 쿼리를 보내서 결과적으로 IP 주소를 찾게 되고 해당 결과물을 응답한다
> * 사전적 의미로써 재귀로, 응답을 돌려주는 쿼리라고 생각하면 된다


> #### Iterative Query - 반복적 질의
> * Recursive DNS 서버가 다른 DNS 서버에게 쿼리를 보내어 응답을 요청하는 작업
> * Recursive 서버가 권한 있는 네임 서버들에게 반복적으로 쿼리를 보내서 결과물을 알아낸다
> * Recursive 서버에 이미 IP 주소가 캐시 되어있다면 이 과정은 생략한다

> #### DNS 동작 과정 전체 예시
> 1. 웹 브라우저에 ww.hanshin.ac.kr을 입력한다
> 2. 웹 브라우저는 이전에 방문한 적 있는지 찾는다
> 3. 브라우저 캐시 확인
     >
4. OS캐시 확인
>    5. 라우터 캐시 확인
>    6. ISP 캐시 확인
> 7. ISP에서 DNS Iterative하게 쿼리를 날린다
> 8. ISP는 Authoritative DNS 서버에서 최종적으로 IP 주소를 응답받는다
> 9. ISP는 해당 IP 주소를 캐시한다
> 10. 웹 브라우저에게 응답한다

