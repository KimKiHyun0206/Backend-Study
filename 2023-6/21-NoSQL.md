# NoSQL

_Non Only SQL_ | _Non-Relational Operational Database_

* `비관계형 데이터베이스 유형` : 관계형 테이블과는 다른 형식으로 데이터 저장
* 언어마다 관습화된 API, 선언적 구조의 쿼리 언어, 쿼리별 언어를 사용하여 질의 가능
* 기존 관계형 DBMS가 가진 특성 뿐만 아니라 다른 특성들을 부가적으로 지원한다

# 사용처

> 높은 확장성과 가용성이 주요 장점이다

> 실시간 웹 애플리케이션 및 빅데이터

* 데이터를 보가 직관적이고 이해하기 쉬운 방식 or 애플리케이션이 사용하는 것에 가까운 방식으로 저장
* NoSQL 스타일의 API를 사용하면 저장 또는 검식 시 데이터 변환의 필요성이 줄어든다
* NoSQL 데이터베이스는 다운 타임이 없는 클라우드의 이점을 완전히 누릴 수 있다

<br>

# NoSQL  VS  SQL

|   비교   | SQL                 | NoSQL                                            |
|:------:|:--------------------|:-------------------------------------------------|
|   형태   | 관계형                 | 비관계형                                             |
| 관리 시스템 | RDBMS 또는 SQL        | 데이터 액세스 구문이 DB마다 다를 수 있다                         |
| 저장 방식  | 테이블이라 불리는 데이터베이스 객체 | SQL 처럼 사전에 스키마를 정의하지 않아도 된다                      |
| 적합한 사용 | 데이터를 저장하고 관리한다      | 크래프 기반, 열 지향, 문서 지향 또는 키-값 저장소 등 <br/>특정 비즈니스 요구수행 사항 |

# 왜 NoSQL 을 선택하는가?

* 유연한 스키마를 제공
* 대량의 데이터 및 낮은 대기시간 또는 응답 시간을 요구
* 이는 애플리케이션에 다양한 데이터 모델 지원

<br>

# NoSQL 을 선택하면 안 되는 경우

> 고전적인 백오피스 비즈니스 애플리케이션은 데이터 변형 및 데이터 중복을 방지하기 위해
> 고도로 정규화된 데이터에 의존한다. 이와 같은 애플리케이션은 NoSQL 데이터베이스와는 어울리지 않는다
> * `백오피스 비즈니스 애플리케이션` : 금융, 회계 등

### 쿼리의 복잡성

> NoSQL은 단일 테이블에 대한 쿼리 잡업이 아주 잘 작동한다.
> 하지만 쿼리의 복잡성이 높아지는 경우, 관계형 데이터베이스가 더 나은 선택이 될 수 있다.

* NoSQL 데이터베이스는 복잡한 JOIN, 하위 쿼리 및 WHERE 절에서의 중첩 질의를 지원하지 않는다

### 컨버지드 모델

> 관계형과 비관계형 모델을 결합해 적용할 수 있는 모델.
> 두 모델의 장점을 모두 가진 모델

* 꼭 관계형 또는 비관계형을 선택해야 하는 것이 아니다
* 다양한 데이터 유형을 처리할 수 있는 유연성을 제공한다
* 성능 저하 없이 일관적인 읽기 및 쓰기를 보장한다

<br>

# NoSQL 만의 특징

> 구조화 되지 않은 스토리지를 사용한다

* NoSQL 의 개발 방향
    * 빠르고 단순한 쿼리
    * 방대한 데이터
    * 작은 애플리케이션 변화를 지원

> Sharding 이라는 프로세스를 거쳐 수평 확장을 가능하게 한다

* 여러 서버에 걸친 데이터 처리를 위해 더 많은 머신을 추가할 수 있다
* SQL DB는 수직 확장성을 지원하기 위해 기존 머신에 더 많은 파워와 메모리를 추가해야 한다
    * 계속해서 더 많은 스토리지가 필요하다 = 지속 불가능하다
* NoSQL 은 수평적 확장성 덕분에 많은 양의 데이터를 효율적으로 처리할 수 있다
    * 데이터가 계속 증가하는 상황에서도 마찬가지이다

```
수직 확장 : 집 안에 새로운 계단 추가
수평 확장 : 기존 건물 옆에 새로운 건물 추가
```

<br>

# NoSQL 의 이점

## 유연성

> NoSQL 을 사용하면 데이터는 엄격한 스키마 없이도 훨씬 더 자유로운 형식으로 저장할 수 있다

* 혁신과 빠른 애플리케이션 개발이 가능해진다(일이 하나 줄으니까)
* 하나의 데이터 저장소에서 구조적, 반구조적, 비구조적 데이터 등 모든 형식의 데이터를 손쉽게 처리할 수 있다

## 확장성

> NoSQL 은 서버를 증설해 확장하는 대신 상업용 하드웨어를 사용해 확장할 수 있다

* 증가한 트래픽을 지원하고 다운 타임 없이 수요를 충족시킬 수 있다
* NoSQL 은 확장을 통해 더 큰 용량과 성능을 갖출 수 있다

## 고성능

> NoSQL 의 확장 아키텍처는 데이터 양이나 트래픽이 증가할 때 장점이 나타난다.

* 빠른 응답시간 보장
* 데이터를 수집하여 빠르고 안정적으로 제공

## 가용성

> 여러 서버, 데이터 센터, 클라우드 리소스 전반의 데이터를 자동으로 복제한다

* 사용자의 위치와 상관없이 사용자 대기시간이 최소화된다
    * 데이터베이스 관리 부담을 줄이는 데에도 효과적이다
* 대기시간이 최소화되기 때문에 더 많은 시간을 우선 순위가 높은 작업에 쓸 수 있다

## 고도의 기능성

> NoSQL 은 데이터 저장 수요가 엄청나게 큰 분산형 데이터 저장소를 위해 설계되었다

* 이 특성 덕분에 NoSQL 은 빅데이터, 실시간 웹 앱 등을 처리하기에 이상적인 데이터베이스이다

<br>

# NoSQL 데이터베이스의 유형

### 키 값

> 애플리케이션이 값 필드에 저장된 모든 데이터를 제약 없이 완벽하게 제어할 수 있다

* 가장 유연한 NoSQL 데이터베이스 유형

### 문서

> 반구조적 데이터의 저장, 검색, 관리에 사용된다

* 문서에 포함할 필드를 특정할 필요가 없다
* 문서 저장소 또는 문서 지향적 데이터베이스라고도 불린다

### 그래프

> 데이터를 노드 및 노드 간 견결을 보여주는 관계로 구성한다

* 더욱 풍부하고 완전한 데이터 표현을 지원한다
* 소셜 네트워크, 예약 시스템, 사기 감지 등에 적용된다

### 넓은 열

> 테이블, 행, 열 형식으로 데이터를 저장 및 관리한다

* 열 형식을 사용하는 애플리케이션에 광범위하게 배포되어 스키마 없는 데이터를 수집한다

# NoSQL의 종류

* MongoDB - Document
* HBase - Wide Columnar Store
* Cassandra - Wide Columnar Store

|    항목    | HBase                                                                                 | Cassandra                                                                                                                                                | MongoDB                                                                                                                                            |
|:--------:|:--------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------|
|   아키텍처   | * Master-Slave 구조                                                                     | * Decentalized 구조로 모든 노드가 동등<br/>* Peer-to-Peer 복제 방식<br/>* gossip 과 Hinted handoff 사용                                                                   | * Master-Slave 구조                                                                                                                                  |
|  구성 환경   | * 복잡한 구성<br/>* HBase + HDFS + ZOOKEEPER 필수 구성                                         | * 단순한 구성<br/>* Cassandra 단일 구성                                                                                                                           | * 단순한 구성<br/>* Sharding 시 config 서버, monogos 서버 추가 구성 필요                                                                                           |
|    복제    | * HDFS 를 이용해서 block replication<br/>* HDFS 에서 replication 지정한 개수 만큼 쓰기 성공 시에 완료 처리    | * replication factor 수만큼 Shard 복제<br/>* consistency level 이 All 인 경우를 제외하고는 consistency level에서 요구되는 수준만 쓰기 성공 시 완료 처리<br/>* 이후 백그라운드 프로세스로 나머지 복제 처리 수행 | * Master-Slave 구조로 replication<br/>* replication 개수 만큼 slave 생성<br/>* WriteConcern level 이 요구하는 수준만 복제 성공 시 완료 처리<br/>* 이후 백그라운드 프로세스로 나머지 복제처리 수행 |
| Sharding | * row key 전체가 Sharding key 가 된다<br/>* range 방식으로 분산<br/>* Hash 방식의 분산은 app에서 구현해야 한다  | * row key 의 일부 속성으로 sharding key 지정 가능<br/>* Hash 방식 분산을 권고하지만 range 방식도 가능하다                                                                            | * row key 가 아닌 일반 컬럼을 sharding key로 지정 가능<br/>* Hash , range 모든 방식 가능                                                                              |
| Analytic | * Hadoop 자체가 저장소이므로 분석용 데이터 센터로 연동하기 쉽다                                               | * Hadoop 연동을 위해 DSE 제품 사용 요구될 수 있따 = 비용 소요                                                                                                               | * Hadoop 연동 connector 사용<br/>* Hbase 보다는 용이하지 않음                                                                                                   |
|    성능    | * Consistency Level 조절이 없으며 row key range scan 트랜잭션에 적합                               | * Consistency Level 에 따라 성능 Trade Off 가 존재하며, Read 보다는 Write Heavy 한 트랜잭션에 적합                                                                            | * WriteConcern level 에 따라 성능 Trade Off 가 존재하며, 물리적인 메모리 사이즈가 성능에 많은 영향을 준다                                                                         |
|   일관성    | * Write 는 한 시점에 1 개의 서버에서 수행하고 Hadoop 의 블록은 복제계수만큼 복제 후 완료 메시지를 전송하므로 consistency 보장됨 | * Level 조절 가능<br/>* Level 을 낮추면 성능은 좋아지나 consistency 보장 못할 수도 있음                                                                                         | * Level 조절 가능(WriteConcern)<br/>* Level 을 낮추면 Consistency 보장 못할 수도 있음                                                                              |
|   가용성    | * 가용성 높음<br/>* 여러 노드들로 분산되어 처리하고 Auto Failover 지원<br/>* 단 rowkey 별 서비스 노드는 1대로 정해져있다  | * 가용성 매우 높음<br/>* 모든 노드가 Coordinator 노드로써 서비스가 가능하여 가용성 높음<br/> * 단 CL이 ALL인 경우 제외                                                                       | * 가용성 높음<br/>* 여러 노드로 분산되어 처리하고 Auto Failover 지원<br/>* 단 write 는 primary 만 가능하다                                                                    |
|   확장성    | * 확장성 용이<br/>* 온라인 중 노드 추가, 제거 시 자동으로 데이터가 재분배됨                                       | * 확장성 용이<br/>* 온라인 노드 추가, 제거 시 자동으로 데이터가 재분배됨                                                                                                            | * 확장성 용이<br/>* 온라인 중 노드 추가, 제거 시 자동으로 데이터가 재분뵈됨                                                                                                    |
|   안정성    | * 안정성 높음                                                                              | * 안정성 높음                                                                                                                                                 | * 안정성 보통<br/>* Write 시 Database Lock 이 발생하여 서비스에 영향을 줄 수 있음                                                                                        |


---
#### 🔗
* [NoSQL 이란?](https://www.oracle.com/kr/database/nosql/what-is-nosql/)
* [다양한 NoSQL Database](https://www.samsungsds.com/kr/insights/1232564_4627.html)
* [위키피디아](https://ko.wikipedia.org/wiki/NoSQL)