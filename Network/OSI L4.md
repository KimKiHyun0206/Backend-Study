# OSI L4

- - -
> OSI 계층에 해당하는 장비인 스위치에 대해 정리한다

## OSI L4 스위치

> * L4 계층의 프로토콜은 TCP 혹은 UDP이다.
> * 그래서 L4 스위치는 TCP나 UDP의 헤더를 보고 스위칭한다.
> * 로드 밸런싱이 가능하다. 일반적으로 다음과 같은 밸런싱 방식을 제공한다

### Round Robin

* L4 하단에 연결된 서버에 순차적으로 접속한다
* 하단의 서버 상태는 상관하지 않는다
* 때에 따라 각 서버 별로 가중치를 부여할 수 있다

### Least Connection

* L4 하단에 현재 세션 수가 적은 서버에 접속한다

### Hash(Source IP)

* 한 번 연결되었던 서버는 계속 그 서버에 접속한다
* 어느 정도 접속 사용자가 늘어나면 거의 공평한 로드 밸런싱이 가능하게 된다
* 새로운 사용자가 들어오면 사용자 IP (혹은 + port) 기반으로 key 값을 생성한다

    이 밖에 Response time 기반, Bandwith 기반 등의 기법이 존재하기도 한다

#### 점검 항목

* L4 구성을 통한 백앤드 서버의 장애 대응 구성 여부
    * 서버 : WEB/WAS 등
* 적절한 부하 분산 여부
    * IP 주소에 따른 밸런싱 확인 등

- - -

## L7 스위치

> 스위치중 가장 똑똑하다

패킷 내용을 좀 더 참조하는데 예를 들면 HTTP의 URL 같은 것을 이용하여 세밀한 로드 밸런싱이 된다

1. http://abc.io/aaa -> 서버 1로 보냄
2. http://abc.io/bbb -> 서버 2로 보냄
3. http://abc.io/ccc -> 서버 3으로 보냄